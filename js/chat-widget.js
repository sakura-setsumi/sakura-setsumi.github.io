var chatThing=function(){"use strict";var E=Object.defineProperty;var M=(h,c,a)=>c in h?E(h,c,{enumerable:!0,configurable:!0,writable:!0,value:a}):h[c]=a;var r=(h,c,a)=>M(h,typeof c!="symbol"?c+"":c,a);const h="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let c=(v=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(v|=0));for(;v--;)e+=h[t[v]&63];return e};const a=window;class w{constructor(){r(this,"config");r(this,"locales",["de","es","fr","it","jp","cn","el"]);r(this,"open",!1);r(this,"interfaceReady",!1);r(this,"payloads",[]);r(this,"messagePreview");r(this,"messagePreviewText",document.createElement("p"));r(this,"trigger",document.createElement("button"));r(this,"chatWindow");r(this,"chatFrame",document.createElement("iframe"));r(this,"showMessagePreview",sessionStorage.getItem("showMessageBubble")==="true");r(this,"messagePreviewVisible",!1);r(this,"parser",new DOMParser);r(this,"powerUps",[]);const e=document.currentScript;if(this.config=a.chatThingConfig||{},this.config.botId=this.config.botId||(e==null?void 0:e.dataset.botId)||(e==null?void 0:e.id),this.config.colour=this.config.colour||{},this.config.colour.widgetColour=this.config.colour.widgetColour||"rgb(17, 24, 39)",this.config.colour.widgetColourInverted=this.config.colour.widgetColourInverted||"rgb(255, 255, 255)",this.config.colour.primaryColour=this.config.colour.primaryColour||"rgb(79, 70, 229)",this.config.colour.primaryColourInverted=this.config.colour.primaryColourInverted||"rgb(255, 255, 255)",this.config.icon=this.config.icon||{},this.config.css=this.config.css||{},this.config.css.widget=this.config.css.widget||`position: fixed;
z-index: 999;
height: 60px;
width: 60px;
border-radius: 100%;
bottom: 20px;
right: 20px;
background: ${this.config.colour.widgetColour};
color: ${this.config.colour.widgetColourInverted};
box-shadow: 0px 4px 19px rgba(0,0,0,0.2);
border: none;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
overflow: hidden;
padding: 0px;`,this.config.svg=this.config.svg||{},this.config.svg.widget=this.config.svg.widget||`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="height: 40px; color: white;">
<path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z" />
</svg>`,this.config.svg.close=this.config.svg.close||`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" style="height: 30px; color: white;">
<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
</svg>`,this.config.css.window=this.config.css.window||`position: fixed;
z-index: 999;
bottom: 100px;
right: 20px;
width: calc(100vw - 40px);
height: calc(100vh - 120px);
max-width: 400px;
max-height: 600px;
background: white;
border-radius: 8px;
background: rgb(17 24 39);
box-shadow: 0px 4px 19px rgba(0,0,0,0.2);
border: 1px solid rgba(255,255,255,0.1);
display: none;
overflow: hidden;`,this.config.css.iframe=this.config.css.iframe||`height: 100%;
width: 100%;
border: 0;`,this.config.css.messagePreviewContainer=this.config.css.messagePreviewContainer||`position: fixed;
z-index: 999;
bottom: 100px;
right: 20px;
transform: translateX(350px);
max-width: 300px;
display: flex;
flex-direction: column;
align-items: end;
gap: 10px;
margin-left: 20px;
transition: transform 0.2s ease-in-out;`,this.config.css.messagePreviewBox=this.config.css.messagePreviewBox||`border-radius: 8px;
background: ${this.config.theme==="dark"?"#1f2937":"#fff"};
color: ${this.config.theme==="dark"?"#d1d5dc":"#374151"};
box-shadow: 0px 4px 19px rgba(0,0,0,0.2);
padding: 15px;
display: flex;
gap: 15px;
cursor: pointer;`,this.config.css.messagePreviewIconImg=this.config.css.messagePreviewIconImg||`color: ${this.config.colour.primaryColourInverted};
padding: 5px;`,this.config.css.messagePreviewIconWrapper=this.config.css.messagePreviewIconWrapper||`background: ${this.config.colour.primaryColour};
border-radius: 100%;
overflow: hidden;
height: 25px;
aspect-ratio: 1;`,this.config.css.messagePreviewText=this.config.css.messagePreviewText||`margin: 2.5px 0;
font-family: Outfit, sans-serif;`,this.config.css.messagePreviewCloseIcon=this.config.css.messagePreviewCloseIcon||`width: 15px; 
aspect-ratio: 1;
color: white;`,this.config.css.messagePreviewCloseButton=this.config.css.messagePreviewCloseButton||`background: #b0acac;
padding: 0;
margin: 0;
border: unset;
line-height: 0;
border-radius: 100%;
padding: 3px;
cursor: pointer;
transition: visibility 0.1s linear, opacity 0.1s linear;`,this.config.css.customAssistantIcon=this.config.css.customAssistantIcon||`width:60px;
height:60px;`,this.config.css.bubbleCustomAssistantIcon=this.config.css.bubbleCustomAssistantIcon||`width:25px;
height:25px;`,this.config.url=this.config.url||"https://chatthing.ai",!this.config.botId){console.error("ChatThing: no bot id found");return}if(this.updateTriggerState(!1),this.trigger.style.cssText=this.config.css.widget,this.trigger.setAttribute("data-cy","button-chatthing"),this.trigger.setAttribute("aria-label","toggle chat window"),this.trigger.addEventListener("click",()=>{this.toggle()}),this.config.firstMessage){const i=document.createElement("link");i.rel="stylesheet",i.href="https://fonts.googleapis.com/css2?family=Outfit&display=swap",document.head.appendChild(i)}this.config.autoOpenDelay&&setTimeout(()=>{this.chatWindow||this.toggle()},this.config.autoOpenDelay),!this.showMessagePreview&&this.config.firstMessage&&this.showPreview(this.config.firstMessage);const t=setInterval(()=>{document.body&&(document.body.appendChild(this.trigger),clearInterval(t))},250);if(window.addEventListener("message",i=>{this.receiveMessageEvent(i)}),this.config.context){var o="";const i=new MutationObserver(()=>{location.href!==o&&(this.extendContext(this.config.context),o=location.href)});i.observe(document,{subtree:!0,childList:!0}),document.addEventListener("beforeunload",()=>{i.disconnect()})}}showPreview(e,t){typeof t>"u"&&(t=this.config.messagePreviewDelay||0),!(this.open||!e)&&(this.messagePreview?this.messagePreviewVisible?(this.slidePreviewOut(),setTimeout(()=>{this.messagePreviewText.innerText=e,this.slidePreviewIn()},200)):(this.messagePreviewText.innerText=e,this.slidePreviewIn()):(this.createPreview(e),setTimeout(()=>{this.slidePreviewIn()},t*1e3)))}hidePreview(){this.messagePreviewVisible&&this.slidePreviewOut()}show(){this.chatWindow||this.create(),!this.open&&this.chatWindow&&(this.updateTriggerState(!0),this.messagePreview&&(this.messagePreview.style.display="none"),this.chatWindow.style.display="block",this.open=!0)}hide(){this.open&&this.chatWindow&&(this.updateTriggerState(!1),this.chatWindow.style.display="none",this.open=!1)}toggle(){this.open?this.hide():this.show()}showTrigger(){this.trigger.style.visibility="visible"}hideTrigger(){this.trigger.style.visibility="hidden"}toggleTrigger(){this.trigger.style.visibility==="hidden"?this.showTrigger():this.hideTrigger()}sendMessage(e){this.sendMessageEvent({action:"send-message",message:e})}systemMessage(e,t){this.sendMessageEvent({action:`${e}-system-message`,message:t})}newConversation(e){this.sendMessageEvent({action:"new-conversation",message:e})}identifyUser(e){this.sendMessageEvent({action:"identify-user",data:e})}extendTheme(e){this.sendMessageEvent({action:"extend-theme",data:e})}registerPowerUp(e){const t=`power-up-${c()}`,o={id:t,enabled:!0,setEnabled:i=>{const s=this.powerUps.find(n=>n.id===t);s&&s.enabled!==i&&(s.enabled=i)},destroy:()=>{this.powerUps.splice(this.powerUps.findIndex(i=>i.id===t),1),this.sendMessageEvent({action:"unregister-power-up",data:{id:t}})},handler:e.handler};return this.powerUps.push(o),this.sendMessageEvent({action:"register-power-up",data:{...e,handler:void 0,id:t}}),o}async callPowerUp({id:e,callId:t,args:o}){const i=this.powerUps.find(s=>s.id===e);if(i)if(!i.enabled)console.warn("power up disabled");else if(i.handler){let s;try{s=await i.handler(o),s??(s="success")}catch(n){s=n}this.sendMessageEvent({action:"response-power-up",data:{callId:t,response:JSON.parse(JSON.stringify(s))}})}else console.error("power up has no handler");else console.error("power up destroyed")}reload(){const e=[this.trigger,this.chatWindow,this.messagePreview];for(const t of e)t&&document.body.removeChild(t);window.removeEventListener("message",this.receiveMessageEvent),a.chatThing=void 0,a.chatThing=new w}create(){var e,t;this.chatWindow||(sessionStorage.setItem("showMessageBubble","true"),this.chatWindow=document.createElement("div"),this.chatWindow.style.cssText=((e=this.config.css)==null?void 0:e.window)||"",this.chatWindow.setAttribute("data-cy","window-chatthing"),this.chatFrame.src=`${this.config.url}/${this.localePrefix}bots/${this.config.botId}/sdk${this.config.initialQuestion?`?initialQuestion=${encodeURIComponent(this.config.initialQuestion)}`:""}`,this.chatFrame.setAttribute("frameborder","0"),this.chatFrame.setAttribute("allow","clipboard-write *"),this.chatFrame.style.cssText=((t=this.config.css)==null?void 0:t.iframe)||"",this.chatWindow.appendChild(this.chatFrame),document.body.appendChild(this.chatWindow))}sendMessageEvent(e){var t;this.interfaceReady?(t=this.chatFrame.contentWindow)==null||t.postMessage({destination:"chat-thing",payload:e},"*"):this.payloads.push(e)}receiveMessageEvent(e){const{data:t}=e;t.destination==="chat-thing"&&(t.payload.action==="interface-ready"&&!this.interfaceReady?(this.interfaceReady=!0,this.payloads.map(o=>{var i;(i=this.chatFrame.contentWindow)==null||i.postMessage({destination:"chat-thing",payload:o},"*")})):t.payload.action==="call-power-up"?this.callPowerUp(t.payload.data):t.payload.action==="close"&&this.open&&this.toggle())}updateTriggerState(e){var t,o,i,s;if(this.trigger.textContent="",e){const n=this.parser.parseFromString((t=this.config.svg)==null?void 0:t.close,"image/svg+xml");this.trigger.appendChild(n.children[0]),this.trigger.setAttribute("aria-pressed","true")}else{if((o=this.config.icon)!=null&&o.widgetIcon){const n=document.createElement("img");n.src=this.config.icon.widgetIcon,n.style.cssText=(i=this.config.css)==null?void 0:i.customAssistantIcon,this.trigger.appendChild(n)}else{const n=this.parser.parseFromString((s=this.config.svg)==null?void 0:s.widget,"image/svg+xml");this.trigger.appendChild(n.children[0])}this.trigger.setAttribute("aria-pressed","false")}}createPreview(e){var l,p,f,m,u,x,b,y,P,C,T;this.messagePreview=document.createElement("div"),this.messagePreview.style.cssText=(l=this.config.css)==null?void 0:l.messagePreviewContainer,document.body.appendChild(this.messagePreview);const t=this.parser.parseFromString((p=this.config.svg)==null?void 0:p.close,"image/svg+xml"),o=t.children[0];o instanceof SVGElement&&(o.style.cssText=(f=this.config.css)==null?void 0:f.messagePreviewCloseIcon);const i=document.createElement("button");i.style.cssText=(m=this.config.css)==null?void 0:m.messagePreviewCloseButton,this.isTouchDevice()||(i.style.visibility="hidden",i.style.opacity="0"),i.appendChild(t.children[0]),i.setAttribute("aria-label","close chat message"),this.messagePreview.appendChild(i);const s=document.createElement("div");s.style.cssText=(u=this.config.css)==null?void 0:u.messagePreviewBox,s.setAttribute("role","alert"),this.messagePreview.appendChild(s);const n=document.createElement("div");s.appendChild(n);const g=document.createElement("div");if(g.style.cssText=(x=this.config.css)==null?void 0:x.messagePreviewIconWrapper,n.appendChild(g),(b=this.config.icon)!=null&&b.widgetIcon){const d=document.createElement("img");d.src=this.config.icon.widgetIcon,d.style.cssText=(y=this.config.css)==null?void 0:y.bubbleCustomAssistantIcon,g.appendChild(d)}else{const d=this.parser.parseFromString((P=this.config.svg)==null?void 0:P.widget,"image/svg+xml"),I=d.children[0];I instanceof SVGElement&&(I.style.cssText=(C=this.config.css)==null?void 0:C.messagePreviewIconImg),g.appendChild(d.children[0])}this.messagePreviewText.style.cssText=(T=this.config.css)==null?void 0:T.messagePreviewText,this.messagePreviewText.textContent=e,s.appendChild(this.messagePreviewText),s.addEventListener("click",()=>{this.toggle()}),this.messagePreview.addEventListener("mouseover",()=>{i.style.visibility="visible",i.style.opacity="1"}),this.messagePreview.addEventListener("mouseleave",()=>{i.style.visibility="hidden",i.style.opacity="0"}),i.addEventListener("click",()=>{sessionStorage.setItem("showMessageBubble","true"),this.slidePreviewOut()})}slidePreviewIn(){this.messagePreview&&(this.messagePreview.style.transform="translateX(0)",this.messagePreviewVisible=!0)}slidePreviewOut(){this.messagePreview&&(this.messagePreview.style.transform="translateX(350px)",this.messagePreviewVisible=!1)}get localePrefix(){return this.config.locale&&this.locales.includes(this.config.locale)?this.config.locale+"/":""}isTouchDevice(){return!!("ontouchstart"in window||navigator.maxTouchPoints)}extendContext(e){const t={};if(e!=null&&e.pageMeta&&(t.pageMeta=this.loadPageMeta()),e!=null&&e.custom&&(t.custom=e.custom),e!=null&&e.dataAttributes){const o=document.querySelectorAll("[data-chat-thing-context]");if(o.length)for(const i of o){const s=i.dataset.chatThingContext;s?(t.custom??(t.custom={}),t.custom[s]=i.innerText):console.warn("missing context identifier")}}Object.keys(t)&&this.sendMessageEvent({action:"extend-context",data:t})}loadPageMeta(){var n,g,l,p,f,m,u;const e=(n=document.querySelector("title"))==null?void 0:n.innerText,t=(l=(g=document.querySelector('meta[name="description"]'))==null?void 0:g.getAttribute("content"))==null?void 0:l.trim(),o=(f=(p=document.querySelector('meta[property="og:title"]'))==null?void 0:p.getAttribute("content"))==null?void 0:f.trim(),i=(u=(m=document.querySelector('meta[property="og:description"]'))==null?void 0:m.getAttribute("content"))==null?void 0:u.trim(),s={url:location.href};return e&&(s.title=e),t&&(s.description=t),o&&(s["og:title"]=o),i&&(s["og:description"]=i),s}}return a.chatThing&&console.warn("chat thing api already present; has the embed script been included more than once?"),a.chatThing=new w,a.chatThing}();